{
  "info": {
    "_postman_id": "4d17f1d0-3b72-4f69-8e62-1a2e4a9cdf01",
    "name": "Legally API",
    "description": "Коллекция запросов для сервиса Legally (публичные, пользовательские и административные эндпоинты).",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:8081"
    },
    {
      "key": "userAccessToken",
      "value": ""
    },
    {
      "key": "refreshToken",
      "value": ""
    },
    {
      "key": "adminAccessToken",
      "value": ""
    },
    {
      "key": "documentId",
      "value": "REPLACE_WITH_DOCUMENT_ID"
    }
  ],
  "item": [
    {
      "name": "Public",
      "description": "Публичные эндпоинты, доступные без авторизации.",
      "item": [
        {
          "name": "Health Check",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/health",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "health"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Register",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Registration succeeded', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "const data = pm.response.json();",
                  "if (data.accessToken) {",
                  "    pm.collectionVariables.set('userAccessToken', data.accessToken);",
                  "}",
                  "if (data.refreshToken) {",
                  "    pm.collectionVariables.set('refreshToken', data.refreshToken);",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"email\": \"user@example.com\",\n    \"password\": \"P@ssw0rd!\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/register",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "register"
              ]
            },
            "description": "Регистрация нового пользователя. Возвращает пару access/refresh токенов."
          },
          "response": []
        },
        {
          "name": "Login",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Login succeeded', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "const data = pm.response.json();",
                  "if (data.accessToken) {",
                  "    pm.collectionVariables.set('userAccessToken', data.accessToken);",
                  "}",
                  "if (data.refreshToken) {",
                  "    pm.collectionVariables.set('refreshToken', data.refreshToken);",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"email\": \"user@example.com\",\n    \"password\": \"P@ssw0rd!\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/login",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "login"
              ]
            },
            "description": "Авторизация пользователя. Возвращает обновлённые access/refresh токены."
          },
          "response": []
        },
        {
          "name": "Refresh Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Refresh succeeded', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "const data = pm.response.json();",
                  "if (data.accessToken) {",
                  "    pm.collectionVariables.set('userAccessToken', data.accessToken);",
                  "}",
                  "if (data.refreshToken) {",
                  "    pm.collectionVariables.set('refreshToken', data.refreshToken);",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"refreshToken\": \"{{refreshToken}}\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/refresh",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "refresh"
              ]
            },
            "description": "Обновление пары токенов по действующему refresh-токену."
          },
          "response": []
        },
        {
          "name": "Validate Token",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{userAccessToken}}"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/validate-token",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "validate-token"
              ]
            },
            "description": "Проверка действительности текущего access-токена."
          },
          "response": []
        },
        {
          "name": "Get Relevant Laws",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/laws",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "laws"
              ]
            },
            "description": "Список нормативных актов, используемых в анализах."
          },
          "response": []
        }
      ]
    },
    {
      "name": "User (Authenticated)",
      "description": "Эндпоинты, доступные авторизованным пользователям (роль user).",
      "item": [
        {
          "name": "Analyze Document",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{userAccessToken}}"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "document",
                  "type": "file",
                  "src": ""
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/api/analyze",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "analyze"
              ]
            },
            "description": "Запуск анализа PDF-документа. Укажите PDF-файл (до 10 МБ) в поле document."
          },
          "response": []
        },
        {
          "name": "Get Analysis History",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{userAccessToken}}"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/history",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "history"
              ]
            },
            "description": "История анализов текущего пользователя (до 50 записей)."
          },
          "response": []
        },
        {
          "name": "Get Current User",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{userAccessToken}}"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/user",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "user"
              ]
            },
            "description": "Информация о текущем пользователе и его роли."
          },
          "response": []
        },
        {
          "name": "Logout",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{userAccessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/logout",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "logout"
              ]
            },
            "description": "Выход пользователя (очистка на клиентской стороне)."
          },
          "response": []
        },
        {
          "name": "Cancel Analysis",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{userAccessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/analysis/cancel",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "analysis",
                "cancel"
              ]
            },
            "description": "Попытка отменить активный анализ для текущего пользователя."
          },
          "response": []
        },
        {
          "name": "Clear File Cache",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{userAccessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/cache/clear",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "cache",
                "clear"
              ]
            },
            "description": "Очистка временного кэша файлов пользователя."
          },
          "response": []
        }
      ]
    },
    {
      "name": "Admin",
      "description": "Административные эндпоинты для управления RAG (требуется роль admin).",
      "item": [
        {
          "name": "Upload RAG Document",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminAccessToken}}"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "title",
                  "value": "Типовой договор поставки",
                  "type": "text"
                },
                {
                  "key": "category",
                  "value": "Договоры",
                  "type": "text"
                },
                {
                  "key": "source",
                  "value": "https://example.com",
                  "type": "text"
                },
                {
                  "key": "document",
                  "type": "file",
                  "src": ""
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/api/admin/rag/upload",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "admin",
                "rag",
                "upload"
              ]
            },
            "description": "Загрузка нового PDF-документа в базу знаний."
          },
          "response": []
        },
        {
          "name": "Search RAG Documents",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminAccessToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"query\": \"поставка\",\n    \"category\": \"\",\n    \"limit\": 10\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/admin/rag/search",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "admin",
                "rag",
                "search"
              ]
            },
            "description": "Поиск документов RAG по тексту и категории."
          },
          "response": []
        },
        {
          "name": "List RAG Documents",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminAccessToken}}"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/admin/rag/documents?limit=20&offset=0",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "admin",
                "rag",
                "documents"
              ],
              "query": [
                {
                  "key": "limit",
                  "value": "20"
                },
                {
                  "key": "offset",
                  "value": "0"
                }
              ]
            },
            "description": "Получение списка RAG-документов с пагинацией."
          },
          "response": []
        },
        {
          "name": "Get RAG Stats",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminAccessToken}}"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/admin/rag/stats",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "admin",
                "rag",
                "stats"
              ]
            },
            "description": "Сводная статистика по документам в RAG."
          },
          "response": []
        },
        {
          "name": "List RAG Categories",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminAccessToken}}"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/admin/rag/categories",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "admin",
                "rag",
                "categories"
              ]
            },
            "description": "Список доступных категорий документов RAG."
          },
          "response": []
        },
        {
          "name": "Delete RAG Document",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminAccessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/admin/rag/documents/{{documentId}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "admin",
                "rag",
                "documents",
                "{{documentId}}"
              ]
            },
            "description": "Удаление RAG-документа по ObjectID."
          },
          "response": []
        },
        {
          "name": "Reprocess RAG Document",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminAccessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/admin/rag/documents/{{documentId}}/reprocess",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "admin",
                "rag",
                "documents",
                "{{documentId}}",
                "reprocess"
              ]
            },
            "description": "Повторная обработка документа (генерация эмбеддингов)."
          },
          "response": []
        }
      ]
    }
  ]
}
